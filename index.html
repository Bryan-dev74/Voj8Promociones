<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Juego de Promociones VOJ8</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="shortcut icon" href="ico.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root { --bg-dark:#1a1a1a; --bg-card:#2c2c2c; --gold:#f8b600; --gold-dark:#d89e00; --text-light:#f5f5f5; --text-muted:#a0a0a0; --success:#22c55e; --error:#ef4444; }
    body{font-family:'Inter',sans-serif;background:var(--bg-dark);color:var(--text-light)}
    .card{background:var(--bg-card);border-radius:1rem;border:1px solid rgba(255,255,255,.1);transition:.3s}
    .btn{transition:.3s;border-radius:.5rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}
    .btn-gold{background:var(--gold);color:var(--bg-dark)}
    .btn-gold:hover{background:var(--gold-dark);transform:translateY(-2px);box-shadow:0 4px 15px rgba(248,182,0,.2)}
    .option-btn{background:#3f3f46;border:2px solid transparent}
    .option-btn:not([disabled]):hover{border-color:var(--gold);color:var(--gold)}
    .option-btn.correct{background:var(--success);color:#fff;border-color:var(--success)}
    .option-btn.incorrect{background:var(--error);color:#fff;border-color:var(--error)}
    .option-btn:disabled{cursor:not-allowed}
    .flashcard-container{perspective:1000px}
    .flashcard{transform-style:preserve-3d;transition:transform .6s}
    .flashcard.is-flipped{transform:rotateY(180deg)}
    .flashcard-face{backface-visibility:hidden;-webkit-backface-visibility:hidden}
    .flashcard-back{transform:rotateY(180deg)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .4s ease-out forwards}
  </style>
</head>
<body class="min-h-screen">
  <div class="container mx-auto p-4 md:p-8 max-w-7xl">
    <header class="text-center mb-10 fade-in">
      <img src="logo.png" alt="VOJ8 Logo" class="mx-auto h-16 mb-4">
      <h1 class="text-4xl md:text-5xl font-black">Centro de Entrenamiento de Promociones</h1>
      <p class="text-lg text-gray-400 mt-2">¬°Domina cada bono y maximiza tus ganancias!</p>
    </header>
    <main id="main-content"></main>
  </div>

  <script>
    const SHOW_EXPLANATION = true; // pon en false si no quer√©s explicaci√≥n breve tras responder

    /* =======================
       DATA
    ======================= */
    const promotionsData = {
      "B√¥nus de 1¬∫ Dep√≥sito + Roda da Fortuna": {
        questions: [
          { question: "¬øQu√© porcentaje de bono se ofrece en el primer dep√≥sito?", answer: "100%" },
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo para participar?", answer: "R$20" },
          { question: "¬øCu√°l es el bono m√°ximo que se puede recibir?", answer: "R$1.000" },
          { question: "¬øQu√© premio adicional se recibe?", answer: "Un giro en la Roda da Fortuna" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "15x" }
        ],
        fillInTheBlanks: [
          { text: "El bono de primer dep√≥sito es de __% hasta R$1.000.", answer: "100" },
          { text: "El rollover para este bono es de __x.", answer: "15" }
        ],
        flashcards: [
          { front: "Porcentaje del bono", back: "100%" },
          { front: "Bono m√°ximo", back: "R$1.000" },
          { front: "Premio adicional", back: "Giro en la Roda da Fortuna" },
          { front: "Rollover", back: "15x" }
        ]
      },
      "B√¥nus de Segundo Dep√≥sito": {
        questions: [
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo para participar?", answer: "R$50" },
          { question: "¬øCu√°l es el bono m√°ximo que se puede recibir?", answer: "R$5.555" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "5x" },
          { question: "¬øC√≥mo se activa este bono?", answer: "Manual al depositar" }
        ],
        fillInTheBlanks: [
          { text: "El bono de segundo dep√≥sito puede llegar hasta R$__.", answer: "5555" },
          { text: "El rollover para este bono es de __x.", answer: "5" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo", back: "R$50" },
          { front: "Bono m√°ximo", back: "R$5.555" },
          { front: "Rollover", back: "5x" }
        ]
      },
      "B√¥nus Di√°rio de 10%": {
        questions: [
          { question: "¬øQu√© porcentaje de bono diario se ofrece?", answer: "10%" },
          { question: "¬øCu√°l es el valor m√≠nimo por recarga para participar?", answer: "R$10" },
          { question: "¬øCu√°l es el bono m√°ximo por d√≠a?", answer: "R$77" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "1x" },
          { question: "¬øQu√© requisito principal debes cumplir para participar?", answer: "Ser miembro del grupo oficial de Telegram" }
        ],
        fillInTheBlanks: [
          { text: "El bono diario te bonifica un __% para que puedas lucrar todo el d√≠a.", answer: "10" },
          { text: "El rollover para este bono es de __x.", answer: "1" }
        ],
        flashcards: [
          { front: "Porcentaje del bono diario", back: "10%" },
          { front: "Rollover", back: "1x" },
          { front: "Bono m√°ximo por d√≠a", back: "R$77" }
        ]
      },
      "Mega Check-in 10 Dias": {
        questions: [
          { question: "¬øCu√°ntos d√≠as dura el evento de Mega Check-in?", answer: "10" },
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo diario para participar?", answer: "R$20" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "3x" },
          { question: "¬øQu√© sucede si se omite un d√≠a de check-in?", answer: "El evento se reinicia y se pierden todos los bonos" }
        ],
        fillInTheBlanks: [
          { text: "El evento dura __ d√≠as.", answer: "10" },
          { text: "El rollover para este bono es de __x.", answer: "3" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo diario", back: "R$20" },
          { front: "Rollover", back: "3x" },
          { front: "Consecuencia de faltar un d√≠a", back: "Pierdes todos los bonos" }
        ]
      },
      "Cashback Instant√¢neo": {
        questions: [
          { question: "¬øQu√© tipo de apuestas califican para el cashback instant√°neo?", answer: "Cualquier juego de casino" },
          { question: "¬øCu√°l es el porcentaje m√°ximo de cashback en slots?", answer: "2%" },
          { question: "¬øA qu√© hora se paga el cashback?", answer: "A las 16:00 del d√≠a siguiente" }
        ],
        fillInTheBlanks: [
          { text: "El cashback m√°ximo en slots es de __%.", answer: "2" }
        ],
        flashcards: [
          { front: "Tipo de apuestas v√°lidas", back: "Cualquier juego de casino" },
          { front: "Cashback m√°ximo en slots", back: "2%" },
          { front: "Hora de pago", back: "16:00 del d√≠a siguiente" }
        ]
      },
      "Cashback Secreto": {
        questions: [
          { question: "¬øEn qu√© juegos aplica el cashback secreto?", answer: "Slots" },
          { question: "¬øCu√°l es el porcentaje de cashback por p√©rdidas?", answer: "3%" },
          { question: "¬øCu√°l es la p√©rdida m√≠nima para calificar?", answer: "R$40" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "1x" }
        ],
        fillInTheBlanks: [
          { text: "El cashback secreto es de __% en slots.", answer: "3" },
          { text: "La p√©rdida m√≠nima para calificar es de R$__.", answer: "40" }
        ],
        flashcards: [
          { front: "Juegos v√°lidos", back: "Slots" },
          { front: "Porcentaje de cashback", back: "3%" },
          { front: "Rollover", back: "1x" }
        ]
      },
      "Cashback USDT": {
        questions: [
          { question: "¬øQu√© porcentaje de cashback se gana en cada dep√≥sito con USDT?", answer: "0.3%" },
          { question: "¬øHay l√≠mite de cashback por dep√≥sito con USDT?", answer: "No hay l√≠mite" }
        ],
        fillInTheBlanks: [
          { text: "El cashback por dep√≥sito con USDT es de __%.", answer: "0.3" }
        ],
        flashcards: [
          { front: "Porcentaje de cashback", back: "0,3%" },
          { front: "L√≠mite de cashback", back: "No hay l√≠mite" }
        ]
      },
      "Clube VIP VOJ8": {
        questions: [
          { question: "¬øCu√°ntos niveles VIP existen en el Club VIP VOJ8?", answer: "50" },
          { question: "¬øCu√°nto tiempo tienes para reclamar el bono de nivel?", answer: "5 d√≠as" }
        ],
        fillInTheBlanks: [
          { text: "El Club VIP tiene __ niveles.", answer: "50" }
        ],
        flashcards: [
          { front: "Niveles VIP", back: "50" },
          { front: "Tiempo para reclamar bono", back: "5 d√≠as" }
        ]
      },
      "Super Programa de Indica√ß√£o": {
        questions: [
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo que debe hacer un referido para que recibas bono?", answer: "R$20" },
          { question: "¬øCu√°nto recibes por cada referido que deposite R$20?", answer: "R$10" },
          { question: "¬øCu√°l es el rollover para el bono directo?", answer: "4x" },
          { question: "¬øHasta qu√© nivel de tu red recibes comisiones?", answer: "Hasta el segundo nivel" },
          { question: "¬øCu√°l es la comisi√≥n sobre 'Slots & Pesca' de tus indicados de Nivel 1?", answer: "0.50%" },
          { question: "¬øCu√°l es la comisi√≥n por dep√≥sito de tus referidos directos?", answer: "0.2%" },
          { question: "¬øCu√°l es el rollover para la comisi√≥n por dep√≥sito?", answer: "1x" }
        ],
        fillInTheBlanks: [
          { text: "El bono directo por referido es de R$__.", answer: "10" },
          { text: "El rollover para el bono directo es de __x.", answer: "4" },
          { text: "La comisi√≥n por dep√≥sito es de __%.", answer: "0.2" },
          { text: "El rollover para la comisi√≥n por dep√≥sito es de __x.", answer: "1" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo referido", back: "R$20" },
          { front: "Bono directo", back: "R$10" },
          { front: "Rollover bono directo", back: "4x" },
          { front: "Comisi√≥n por dep√≥sito", back: "0,2%" },
          { front: "Rollover comisi√≥n dep√≥sito", back: "1x" },
          { front: "Niveles de comisi√≥n", back: "Hasta el segundo nivel" },
          { front: "Comisi√≥n Nivel 1 Slots", back: "0,5%" }
        ]
      },
      "Evento: ¬°Feliz Cumplea√±os!": {
        questions: [
          { question: "¬øQu√© porcentaje de bono se ofrece por el cumplea√±os?", answer: "100%" },
          { question: "¬øCu√°l es el valor m√°ximo del Cup√≥n VIP de cumplea√±os?", answer: "R$888" },
          { question: "¬øCu√°l es el rollover para el bono de cumplea√±os?", answer: "10x" }
        ],
        fillInTheBlanks: [
          { text: "El bono de cumplea√±os es de __% del dep√≥sito.", answer: "100" },
          { text: "El rollover para este bono es de __x.", answer: "10" }
        ],
        flashcards: [
          { front: "Porcentaje de bono cumplea√±os", back: "100%" },
          { front: "Cup√≥n VIP m√°ximo", back: "R$888" },
          { front: "Rollover", back: "10x" }
        ]
      },
      "Chuva de Envelopes Premiados!": {
        questions: [
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo para participar?", answer: "R$20" },
          { question: "¬øCu√°ntas veces al d√≠a se realizan los sorteos?", answer: "4" },
          { question: "¬øCu√°l es el premio m√°ximo que se puede ganar?", answer: "R$8.888" }
        ],
        fillInTheBlanks: [
          { text: "El premio m√°ximo en la Chuva de Envelopes es de R$__.", answer: "8888" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo para participar", back: "R$20" },
          { front: "N√∫mero de sorteos diarios", back: "4" },
          { front: "Premio m√°ximo", back: "R$8.888" }
        ]
      },
      "C√≥digo Premiado VOJ8": {
        questions: [
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo para participar?", answer: "R$20" },
          { question: "¬øCu√°l es el rollover si aciertas todos los n√∫meros?", answer: "0x" },
          { question: "¬øQu√© se debe enviar para reclamar el premio?", answer: "El print de la apuesta" }
        ],
        fillInTheBlanks: [
          { text: "El rollover si aciertas todos los n√∫meros es de __x.", answer: "0" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo para participar", back: "R$20" },
          { front: "Rollover m√°ximo", back: "0x" }
        ]
      },
      "Promo√ß√£o da Sorte VOJ8: OVO PREMIADO 777": {
        questions: [
          { question: "¬øCu√°l es el rango del premio que se puede ganar?", answer: "R$7 a R$777" },
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo diario para participar?", answer: "R$20" },
          { question: "¬øQu√© acci√≥n se debe realizar para participar?", answer: "Enviar email a promosvoj8@gmail.com" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "1x" }
        ],
        fillInTheBlanks: [
          { text: "El rango del premio es de R$__ a R$777.", answer: "7" },
          { text: "El rollover para este bono es de __x.", answer: "1" }
        ],
        flashcards: [
          { front: "Rango del premio", back: "R$7 a R$777" },
          { front: "Dep√≥sito m√≠nimo diario", back: "R$20" },
          { front: "Acci√≥n requerida", back: "Enviar email a promosvoj8@gmail.com" },
          { front: "Rollover", back: "1x" }
        ]
      },
      "Festival de Pr√™mios PG": {
        questions: [
          { question: "¬øCu√°l es el requisito de apuestas en slots de PG para participar?", answer: "R$1.000" },
          { question: "¬øCu√°ntos ganadores diarios hay?", answer: "2000" },
          { question: "¬øCu√°l es el premio fijo por ganador?", answer: "R$50" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "1x" }
        ],
        fillInTheBlanks: [
          { text: "El requisito de apuesta diaria es de R$__ en slots PG.", answer: "1000" },
          { text: "El rollover para este bono es de __x.", answer: "1" }
        ],
        flashcards: [
          { front: "Requisito de apuesta diaria", back: "R$1.000" },
          { front: "N√∫mero de ganadores diarios", back: "2000" },
          { front: "Premio fijo por ganador", back: "R$50" },
          { front: "Rollover", back: "1x" }
        ]
      },
      "B√¥nus VOJ8 de Ganhos": {
        questions: [
          { question: "¬øCu√°l es el dep√≥sito m√≠nimo para participar?", answer: "R$20" },
          { question: "¬øQu√© ganancia m√≠nima se debe obtener en una apuesta para recibir el bono?", answer: "R$20" },
          { question: "¬øCu√°l es el monto del bono que se recibe?", answer: "R$10" },
          { question: "¬øCu√°l es el rollover para este bono?", answer: "1x" }
        ],
        fillInTheBlanks: [
          { text: "La ganancia m√≠nima para recibir el bono es de R$__.", answer: "20" },
          { text: "El monto del bono es de R$__.", answer: "10" },
          { text: "El rollover para este bono es de __x.", answer: "1" }
        ],
        flashcards: [
          { front: "Dep√≥sito m√≠nimo", back: "R$20" },
          { front: "Ganancia m√≠nima", back: "R$20" },
          { front: "Monto del bono", back: "R$10" },
          { front: "Rollover", back: "1x" }
        ]
      },
      "B√¥nus Gr√°tis: Ovo de Ouro da Sorte": {
        questions: [
          { question: "¬øQu√© dos acciones son necesarias para obtener el bono?", answer: "Vincular email y verificar tel√©fono" },
          { question: "¬øCu√°l es el premio m√°ximo que se puede ganar?", answer: "R$1.088" }
        ],
        fillInTheBlanks: [
          { text: "El premio m√°ximo del Ovo de Ouro es de R$__.", answer: "1088" }
        ],
        flashcards: [
          { front: "Acciones necesarias", back: "Vincular email y verificar tel√©fono" },
          { front: "Premio m√°ximo", back: "R$1.088" }
        ]
      },
      "Momento de Compartilhar": {
        questions: [
          { question: "¬øCu√°nto se gana por compartir en Facebook?", answer: "R$5" },
          { question: "¬øCu√°nto se gana por compartir en Instagram?", answer: "R$5" },
          { question: "¬øCu√°nto tiempo debe permanecer visible la publicaci√≥n?", answer: "12 horas" }
        ],
        fillInTheBlanks: [
          { text: "El tiempo m√≠nimo de publicaci√≥n es de __ horas.", answer: "12" }
        ],
        flashcards: [
          { front: "Premio por compartir en Facebook", back: "R$5" },
          { front: "Premio por compartir en Instagram", back: "R$5" },
          { front: "Tiempo m√≠nimo de publicaci√≥n", back: "12 horas" }
        ]
      }
    };

    const promotionDisplayNames = {
      "B√¥nus de 1¬∫ Dep√≥sito + Roda da Fortuna": "Bono 1er Dep√≥sito + Rueda",
      "B√¥nus de Segundo Dep√≥sito": "Bono de Segundo Dep√≥sito",
      "B√¥nus Di√°rio de 10%": "Bono Diario del 10%",
      "Mega Check-in 10 Dias": "Mega Check-in de 10 D√≠as",
      "Cashback Instant√¢neo": "Cashback Instant√¢neo",
      "Cashback Secreto": "Cashback Secreto",
      "Cashback USDT": "Cashback con Cripto",
      "Clube VIP VOJ8": "Club VIP",
      "Super Programa de Indica√ß√£o": "Programa de Indicaci√≥n",
      "Evento: ¬°Feliz Cumplea√±os!": "Bono de Cumplea√±os",
      "Chuva de Envelopes Premiados!": "Lluvia de Sobres Premiados",
      "C√≥digo Premiado VOJ8": "C√≥digo Premiado",
      "Promo√ß√£o da Sorte VOJ8: OVO PREMIADO 777": "Sorteo OVO PREMIADO 777",
      "Festival de Pr√™mios PG": "Festival de Premios PG",
      "B√¥nus VOJ8 de Ganhos": "Bono de Ganancias",
      "B√¥nus Gr√°tis: Ovo de Ouro da Sorte": "Huevo de Oro de la Suerte",
      "Momento de Compartilhar": "Comparte y Gana"
    };

    /* =======================
       STATE / STORAGE
    ======================= */
    let state = {
      currentView:'menu',
      activePromotionKey:null,
      activeGameLevel:0,
      progress:{},
      gameData:{} // { review: [ {q, correct, selected, ok} ] , ... }
    };
    const mainContent = document.getElementById('main-content');

    function initProgress(){
      try{ const saved=localStorage.getItem('voj8GameProgress'); state.progress=saved?JSON.parse(saved):{}; }catch{ state.progress={}; }
      getVisiblePromoKeys().forEach(k=>{ if(typeof state.progress[k]!=='number') state.progress[k]=0; });
      saveProgress();
    }
    function saveProgress(){ try{ localStorage.setItem('voj8GameProgress', JSON.stringify(state.progress)); }catch{} }

    /* =======================
       RENDER
    ======================= */
    function getVisiblePromoKeys(){ return Object.keys(promotionDisplayNames).filter(k=>!!promotionsData[k]); }
    function render(){ mainContent.innerHTML=''; if(state.currentView==='menu') renderMenu(); else renderGame(); }

    function renderMenu(){
      const promoKeys = getVisiblePromoKeys();
      const maxLevel=5;
      const cardsHTML = promoKeys.map(key=>{
        const displayName=promotionDisplayNames[key];
        const level=state.progress[key]||0;
        const stars='üåü'.repeat(level)+'‚òÜ'.repeat(maxLevel-level);
        return `
        <div class="card p-4 flex flex-col justify-between text-center fade-in hover:shadow-lg hover:border-yellow-400">
          <div>
            <h3 class="text-xl font-bold mb-2">${displayName}</h3>
            <p class="text-4xl mb-4">${stars}</p>
          </div>
          <button onclick="selectPromotion('${key}')" class="btn btn-gold py-2 px-4 mt-2">Entrenar</button>
        </div>`;
      }).join('');
      mainContent.innerHTML = `
        <section id="promotion-menu">
          <div class="flex justify-end mb-6">
            <button onclick="resetProgress()" class="btn bg-gray-700 text-white py-2 px-6 hover:bg-red-500">Reiniciar Historial</button>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">${cardsHTML}</div>
        </section>`;
    }
    function resetProgress(){ getVisiblePromoKeys().forEach(k=>state.progress[k]=0); saveProgress(); render(); }

    function renderGame(){
      mainContent.innerHTML = '';

      const displayName = promotionDisplayNames[state.activePromotionKey] || state.activePromotionKey || '';
      const level=state.progress[state.activePromotionKey]||0;
      const gameTypes=['Opci√≥n M√∫ltiple','Completar Texto (Selecci√≥n M√∫ltiple)','Completar la Regla','Verdadero/Falso','Tarjetas de Memoria'];
      const maxLevel=5;
      let list='';
      for(let i=1;i<=maxLevel;i++){
        const unlocked=i<=level+1, complete=i<=level;
        list+=`
          <button onclick="${unlocked?`startGame(${i})`:''}"
            class="btn p-4 w-full text-left ${unlocked?'bg-gray-700 hover:bg-yellow-400 hover:text-black scale-105':'bg-gray-800 text-gray-500 cursor-not-allowed'}">
            <div class="flex justify-between items-center">
              <span>Nivel ${i}: ${gameTypes[i-1]}</span>
              <span class="text-2xl">${complete?'‚úÖ':(unlocked?'‚ñ∂Ô∏è':'üîí')}</span>
            </div>
          </button>`;
      }
      const wrap=document.createElement('div');
      wrap.className='fade-in';
      wrap.innerHTML=`
        <div class="max-w-4xl mx-auto">
          <button onclick="goToMenu()" class="btn bg-gray-700 text-white py-2 px-4 mb-6 hover:bg-gray-600">‚Üê Volver al Men√∫</button>
          <div class="card p-6 md:p-8">
            <h2 class="text-3xl font-bold mb-6 text-center text-yellow-400">${displayName}</h2>
            <div id="game-content" class="space-y-4">${state.activeGameLevel===0?list:''}</div>
          </div>
        </div>`;
      mainContent.appendChild(wrap);

      if(state.activeGameLevel>0){
        const c=document.getElementById('game-content');
        if(state.activeGameLevel===1) renderMultipleChoice(c);
        if(state.activeGameLevel===2) renderCompleteTextMC(c);
        if(state.activeGameLevel===3) renderFillInTheBlank(c);
        if(state.activeGameLevel===4) renderTrueFalse(c);
        if(state.activeGameLevel===5) renderFlashcards(c);
      }
    }

    /* =======================
       TIPADO + CONTEXTO
    ======================= */
    const percentRe = /^\d+(\.\d+)?%$/i;
    const rolloverRe = /^\d+\s*x$/i;
    const moneyRe = /^r\$/i;

    function parseAnswerType(ans){
      const a=String(ans).trim();
      if(percentRe.test(a)) return {type:'porcentaje', value:parseFloat(a)};
      if(rolloverRe.test(a)) return {type:'rollover', value:parseFloat(a)};
      if(moneyRe.test(a))    return {type:'monto', value:parseFloat(a.replace(/[^\d]/g,''))};
      if(/^\d+$/.test(a))    return {type:'numero', value:parseFloat(a)};
      return {type:'texto', value:a};
    }

    const fmtMoney = (n)=>`R$${Number(n).toLocaleString('pt-BR')}`;

    function contextCandidates(promoKey, qText, correct){
      const q=qText.toLowerCase();
      const {type, value} = parseAnswerType(correct);

      // Contexto por bono (resumen duro para opciones plausibles)
      if(promoKey.includes('1¬∫ dep√≥sito')){
        if(q.includes('porcentaje')) return ['50%','150%','200%'];
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$50','R$100'];
        if(q.includes('bono m√°ximo')) return ['R$500','R$1.500','R$2.000'];
        if(q.includes('premio adicional')) return ['Cashback 5%','Puntos VIP','2 giros en la rueda'];
        if(q.includes('rollover')) return ['10x','20x','25x'];
      }
      if(promoKey.includes('Segundo Dep√≥sito')){
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$20','R$100','R$200'];
        if(q.includes('bono de segundo dep√≥sito puede llegar')) return [fmtMoney(1055), fmtMoney(2000), fmtMoney(10000)];
        if(q.includes('bono m√°ximo')) return [fmtMoney(1055), fmtMoney(2000), fmtMoney(10000)];
        if(q.includes('rollover')) return ['3x','10x','15x'];
        if(q.includes('activa')) return ['Autom√°ticamente','Contactando soporte','Por Telegram'];
      }
      if(promoKey.includes('Di√°rio') || promoKey.includes('Diario')){
        if(q.includes('porcentaje')) return ['5%','15%','20%'];
        if(q.includes('m√≠nimo por recarga')) return ['R$5','R$20','R$50'];
        if(q.includes('m√°ximo por d√≠a')) return ['R$50','R$88','R$100'];
        if(q.includes('rollover')) return ['0x','3x','5x'];
        if(q.includes('requisito')||q.includes('grupo')) return ['Hacer una apuesta deportiva','Depositar con USDT','Ser VIP'];
      }
      if(promoKey.includes('Check-in')){
        if(q.includes('cu√°ntos d√≠as')) return ['7','5','15'];
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$30','R$50'];
        if(q.includes('rollover')) return ['1x','5x','10x'];
        if(q.includes('omite')||q.includes('faltar')) return ['Se pierde solo el bono de ese d√≠a','Se puede continuar al d√≠a siguiente','Se baja un nivel'];
      }
      if(promoKey.includes('Instant√¢neo')){
        if(q.includes('apuestas califican')) return ['Solo slots','Solo apuestas deportivas','Solo poker'];
        if(q.includes('porcentaje m√°ximo')) return ['0.5%','1%','1.2%'];
        if(q.includes('hora')) return ['A la medianoche','Al instante','A las 18:00 del d√≠a siguiente'];
      }
      if(promoKey.includes('Secreto')){
        if(q.includes('juegos aplica')) return ['Poker','Apuestas deportivas','Todos los juegos'];
        if(q.includes('porcentaje')) return ['1%','2%','5%'];
        if(q.includes('p√©rdida m√≠nima')) return ['R$20','R$50','R$100'];
        if(q.includes('rollover')) return ['3x','5x','Sin rollover'];
      }
      if(promoKey.includes('USDT')){
        if(q.includes('porcentaje')) return ['0.1%','0.5%','1%'];
        if(q.includes('l√≠mite')) return ['S√≠, R$100 por d√≠a','S√≠, R$1.000 en total','S√≠, depende del nivel VIP'];
      }
      if(promoKey.includes('VIP')){
        if(q.includes('niveles')) return ['25','40','100'];
        if(q.includes('reclamar')) return ['1 d√≠a','3 d√≠as','10 d√≠as'];
      }
      if(promoKey.includes('Indica√ß√£o')){
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$50','R$100'];
        if(q.includes('cu√°nto recibes')) return ['R$5','R$15','R$20'];
        if(q.includes('rollover') && q.includes('bono directo')) return ['1x','5x','10x'];
        if(q.includes('hasta qu√© nivel')) return ['Solo directos','Hasta el tercer nivel','No hay comisiones por nivel'];
        if(q.includes('slots & pesca')) return ['0.10%','0.30%','1.00%'];
        if(q.includes('comisi√≥n por dep√≥sito')) return ['0.1%','0.5%','1%'];
        if(q.includes('rollover para la comisi√≥n')) return ['2x','3x','4x'];
      }
      if(promoKey.includes('Cumple')){
        if(q.includes('porcentaje')) return ['50%','75%','200%'];
        if(q.includes('cup√≥n')||q.includes('valor m√°ximo')) return [fmtMoney(188), fmtMoney(588), fmtMoney(1088)];
        if(q.includes('rollover')) return ['1x','5x','15x'];
      }
      if(promoKey.includes('Envelopes')){
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$50','No hay m√≠nimo'];
        if(q.includes('veces al d√≠a')) return ['1','2','3'];
        if(q.includes('premio m√°ximo')) return [fmtMoney(888), fmtMoney(1088), fmtMoney(5000)];
      }
      if(promoKey.includes('C√≥digo Premiado')){
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$50','R$100'];
        if(q.includes('rollover')) return ['1x','5x','10x'];
        if(q.includes('enviar')) return ['El c√≥digo','Un video','El ID de la apuesta'];
      }
      if(promoKey.includes('OVO PREMIADO 777')){
        if(q.includes('rango del premio')) return ['R$7 a R$77','R$77 a R$777','R$1 a R$777'];
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$30','R$50'];
        if(q.includes('acci√≥n')) return ['Contactar soporte','Publicar en redes sociales','Jugar en un slot espec√≠fico'];
        if(q.includes('rollover')) return ['3x','5x','10x'];
      }
      if(promoKey.includes('Pr√™mios PG')){
        if(q.includes('requisito de apuestas')) return [fmtMoney(500), fmtMoney(2000), fmtMoney(5000)];
        if(q.includes('ganadores diarios')) return ['100','500','1000'];
        if(q.includes('premio fijo')) return [fmtMoney(10), fmtMoney(25), fmtMoney(100)];
        if(q.includes('rollover')) return ['3x','5x','10x'];
      }
      if(promoKey.includes('Ganhos')){
        if(q.includes('dep√≥sito m√≠nimo')) return ['R$10','R$50','R$100'];
        if(q.includes('ganancia m√≠nima')) return ['R$10','R$50','R$100'];
        if(q.includes('monto del bono')) return ['R$5','R$20','R$50'];
        if(q.includes('rollover')) return ['3x','5x','10x'];
      }
      if(promoKey.includes('Ovo de Ouro')){
        if(q.includes('acciones')||q.includes('necesarias')) return ['Depositar y apostar','Ser VIP y unirse al grupo','Seguir en redes y compartir'];
        if(q.includes('premio m√°ximo')) return [fmtMoney(88), fmtMoney(188), fmtMoney(8888)];
      }
      if(promoKey.includes('Compartilhar')){
        if(q.includes('facebook')) return ['R$1','R$2','R$10'];
        if(q.includes('instagram')) return ['R$1','R$2','R$10'];
        if(q.includes('tiempo')||q.includes('visible')) return ['1 hora','24 horas','48 horas'];
      }

      // Fallback por tipo:
      if(type==='monto'){
        const pool=[10,20,30,40,50,77,88,100,200,500,1000,2000,5555,8888];
        return pool.filter(v=>v!==value).slice(0,3).map(v=>fmtMoney(v));
      }
      if(type==='porcentaje'){ const p=[1,3,5,10,15,20,25,50,100]; return p.filter(v=>v!==value).slice(0,3).map(v=>`${v}%`); }
      if(type==='rollover'){ const r=[1,2,3,4,5,10,15,20,30]; return r.filter(v=>v!==value).slice(0,3).map(v=>`${v}x`); }
      if(type==='numero'){ const n=[1,2,3,4,5,7,10,12,15,20]; return n.filter(v=>v!==value).slice(0,3).map(String); }
      return null;
    }

    function buildOptionsForQuestion(promoKey, qObj){
      const base = [qObj.answer];
      const ctx = contextCandidates(promoKey, qObj.question, qObj.answer) || [];
      let opts = base.concat(ctx).slice(0,4);
      while(opts.length<4){ opts.push('N/A '+Math.floor(Math.random()*100)); }
      return shuffleArray(opts);
    }

    // Para Completar-Texto, si el enunciado tiene R$ / % / x y la respuesta es num√©rica (p. ej. "5555"),
    // formateamos las opciones correctamente (R$5.555, 10%, 5x, etc) y generamos distractores cercanos.
    function buildOptionsForFill(text, answer, promoKey){
      const hasMoney = /r\$\s*__/i.test(text) || /r\$\s*[\s]*__/.test(text);
      const hasPercent = /__\s*%/.test(text);
      const hasRollover = /__\s*x/.test(text);

      let normalizedCorrect = String(answer);
      let correctDisplay = answer;

      if(hasMoney && /^\d+$/.test(answer)) { correctDisplay = fmtMoney(answer); }
      if(hasPercent && /^\d+(\.\d+)?$/.test(answer)) { correctDisplay = `${answer}%`; }
      if(hasRollover && /^\d+$/.test(answer)) { correctDisplay = `${answer}x`; }

      // Base + context
      let ctx = contextCandidates(promoKey, text, correctDisplay) || [];

      // Si el contexto no trajo alternativas v√°lidas, fabricamos cercanas
      if(ctx.length===0){
        if(hasMoney && /^\d+$/.test(answer)){
          const v = parseInt(answer,10);
          let pool = [1000,2000,5000,8888,1055,777];
          pool = pool.filter(x=>x!==v).slice(0,3);
          ctx = pool.map(fmtMoney);
        }else if(hasPercent){
          const v = parseFloat(answer); const pool=[1,3,5,10,15,20,25,50,100].filter(x=>x!==v).slice(0,3); ctx = pool.map(x=>`${x}%`);
        }else if(hasRollover){
          const v = parseInt(answer,10); const pool=[1,3,4,5,10,15,20].filter(x=>x!==v).slice(0,3); ctx = pool.map(x=>`${x}x`);
        }
      }

      const options = shuffleArray([correctDisplay, ...ctx].slice(0,4));
      return { options, correctDisplay };
    }

    /* =======================
       GAME RENDERS/LOGIC
    ======================= */
    function ensureReview(){ if(!state.gameData.review) state.gameData.review = []; }

    function renderMultipleChoice(container){
      const promo = promotionsData[state.activePromotionKey]||{};
      const questions = promo.questions||[];
      const { currentQuestionIndex=0 } = state.gameData;
      if(!questions.length){ showSummary(container); return; }
      if(currentQuestionIndex>=questions.length){ showSummary(container); return; }

      const q=questions[currentQuestionIndex];
      const options = buildOptionsForQuestion(state.activePromotionKey, q);

      container.innerHTML = `
        <p class="text-xl text-gray-300 mb-1">Pregunta ${currentQuestionIndex+1} de ${questions.length}</p>
        <h3 class="text-2xl font-semibold mb-4">${q.question}</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2">
          ${options.map(opt=>`<button onclick="checkMultipleChoiceAnswer(this,'${opt.replace(/'/g,"\\'")}')" class="btn option-btn p-4 w-full text-left">${opt}</button>`).join('')}
        </div>
        <div id="mc-explain" class="text-sm text-gray-400"></div>`;
    }

    function checkMultipleChoiceAnswer(button, selected){
      const promo=promotionsData[state.activePromotionKey];
      const { currentQuestionIndex=0 } = state.gameData;
      const qObj = promo.questions[currentQuestionIndex];
      const correct = qObj.answer;
      document.querySelectorAll('.option-btn').forEach(b=>b.disabled=true);
      const explain = document.getElementById('mc-explain');
      const ok = selected===correct;

      ensureReview();
      state.gameData.review.push({ q:qObj.question, correct, selected, ok });

      if(ok){
        button.classList.add('correct'); confettiEffect();
        if(SHOW_EXPLANATION && explain){ explain.innerHTML = buildExplanation(qObj, correct); }
        setTimeout(()=>{ state.gameData.currentQuestionIndex=(currentQuestionIndex||0)+1; renderMultipleChoice(document.getElementById('game-content')); },900);
      }else{
        button.classList.add('incorrect');
        document.querySelectorAll('.option-btn').forEach(b=>{ if(b.innerText===correct) b.classList.add('correct'); });
        flashRedEffect(); if(explain) explain.innerHTML='';
        setTimeout(()=>{ let prev=(currentQuestionIndex||0)-1; state.gameData.currentQuestionIndex=prev<0?0:prev; renderMultipleChoice(document.getElementById('game-content')); },950);
      }
    }

    function buildExplanation(q, correct){
      const lc=q.question.toLowerCase();
      if(lc.includes('dep√≥sito m√≠nimo')) return `üìå El m√≠nimo establecido para esta promo es <b>${correct}</b>.`;
      if(lc.includes('porcentaje')) return `üìå El porcentaje oficial es <b>${correct}</b>.`;
      if(lc.includes('bono m√°ximo')||lc.includes('premio m√°ximo')) return `üìå El m√°ximo permitido es <b>${correct}</b>.`;
      if(lc.includes('hora')) return `üìå El pago se programa a <b>${correct}</b>.`;
      if(lc.includes('rollover')) return `üìå El rollover definido es <b>${correct}</b>.`;
      if(lc.includes('acciones')||lc.includes('acci√≥n')) return `üìå Para participar se requiere <b>${correct}</b>.`;
      return `‚úÖ Correcto: <b>${correct}</b>.`;
    }

    function renderFlashcards(container){
      const promo = promotionsData[state.activePromotionKey]||{};
      const flashcards = promo.flashcards||[];
      const { currentCardIndex=0, selfCheck=false } = state.gameData;
      if(!flashcards.length){ showSummary(container); return; }
      if(currentCardIndex>=flashcards.length){ showSummary(container); return; }

      const card=flashcards[currentCardIndex];
      const hint = (promo.questions && promo.questions[currentCardIndex]) ? promo.questions[currentCardIndex].question : '';
      container.innerHTML = `
        <p class="text-xl text-gray-300 mb-4">Tarjeta ${currentCardIndex+1} de ${flashcards.length}</p>
        ${hint?`<div class='mb-2 text-lg text-yellow-400 font-semibold'>Pista: ${hint}</div>`:''}
        <div class="flashcard-container h-64">
          <div id="flashcard" class="flashcard relative w-full h-full ${selfCheck?'is-flipped':''}">
            <div class="flashcard-face absolute w-full h-full card flex items-center justify-center p-4 text-center bg-gray-800 border-2 border-yellow-400">
              <h3 class="text-3xl font-bold">${card.front}</h3>
            </div>
            <div class="flashcard-back absolute w-full h-full card flex items-center justify-center p-4 text-center bg-yellow-400 text-black">
              <p class="text-2xl font-semibold">${card.back}</p>
            </div>
          </div>
        </div>
        <div class="mt-6 flex flex-col items-center gap-4">
          <button onclick="flipCard()" class="btn bg-gray-600 py-3 px-6">Revelar</button>
          <div class="mt-2">
            <input type="text" id="flashcard-input" class="mx-2 p-2 rounded bg-gray-900 border-2 border-gray-600 focus:border-yellow-400 focus:outline-none text-center w-48" placeholder="Escribe la respuesta">
            <button onclick="checkFlashcardSelfCheck()" class="btn btn-gold py-2 px-4 ml-2">Comprobar</button>
          </div>
          <div id="flashcard-feedback" class="text-center text-xl font-bold mt-2 h-8"></div>
          <button onclick="nextFlashcard()" class="btn btn-gold py-3 px-6">Siguiente</button>
        </div>`;
    }
    function flipCard(){ const fc=document.getElementById('flashcard'); if(fc){ fc.classList.toggle('is-flipped'); state.gameData.selfCheck=!state.gameData.selfCheck; } }
    function checkFlashcardSelfCheck(){
      const promo=promotionsData[state.activePromotionKey]||{}; const f=promo.flashcards||[];
      const { currentCardIndex=0 } = state.gameData;
      const input=document.getElementById('flashcard-input'); const fb=document.getElementById('flashcard-feedback');
      if(!input||!fb||!f[currentCardIndex]) return;
      const ok = normalizeText(input.value)===normalizeText(f[currentCardIndex].back);
      fb.textContent = ok?'¬°Correcto!':'Sigue intentando'; fb.style.color=ok?'var(--success)':'var(--error)'; if(ok) confettiEffect();
      ensureReview(); state.gameData.review.push({ q:`Flashcard: ${f[currentCardIndex].front}`, correct:f[currentCardIndex].back, selected:input.value, ok });
    }
    function nextFlashcard(){ const {currentCardIndex=0}=state.gameData; state.gameData.currentCardIndex=currentCardIndex+1; state.gameData.selfCheck=false; renderFlashcards(document.getElementById('game-content')); }

    function renderCompleteTextMC(container){
      const promo=promotionsData[state.activePromotionKey]||{};
      const { questions=[], flashcards=[], fillInTheBlanks=[] } = promo;

      let all=[];
      fillInTheBlanks.forEach(q=>all.push({text:q.text, answer:q.answer}));
      questions.forEach(q=>{ all.push({text:`La respuesta correcta a: '${q.question}' es __.`, answer:q.answer}); });
      flashcards.forEach(f=>all.push({text:`La respuesta a la tarjeta: '${f.front}' es __.`, answer:f.back}));

      const { completeIndex=0 } = state.gameData;
      if(!all.length){ showSummary(container); return; }
      if(completeIndex>=all.length){ showSummary(container); return; }

      const item=all[completeIndex];
      const { options, correctDisplay } = buildOptionsForFill(item.text, item.answer, state.activePromotionKey);

      container.innerHTML = `
        <p class="text-xl text-gray-300 mb-4">Completa el texto seleccionando la opci√≥n correcta</p>
        <p class="text-2xl leading-relaxed text-center mb-6">${item.text.replace('__','<span class="underline text-yellow-400">____</span>')}</p>
        <div class="flex flex-col items-center gap-4 mb-2">
          ${options.map(opt=>`<button class="btn btn-gold py-2 px-6" onclick="checkCompleteTextMC(this,'${opt.replace(/'/g,"\\'")}','${correctDisplay.replace(/'/g,"\\'")}')">${opt}</button>`).join('')}
        </div>
        <div id="complete-feedback" class="text-center text-sm text-gray-400 h-6"></div>`;
      state.gameData._ct_correctDisplay = correctDisplay; // para resumen bonito
      state.gameData.completeCurrentAnswer = correctDisplay;
      state.gameData.completeIndex = completeIndex;
    }
    function checkCompleteTextMC(btn,selected,correctShown){
      const correct = state.gameData.completeCurrentAnswer || correctShown;
      const fb=document.getElementById('complete-feedback');
      document.querySelectorAll('.btn-gold').forEach(b=>b.disabled=true);
      const ok = normalizeText(selected)===normalizeText(correct);
      fb.innerHTML = ok && SHOW_EXPLANATION ? `‚úÖ Correcto: <b>${correct}</b>` : (ok?'':'Incorrecto. Retrocedes una pregunta.');
      fb.style.color = ok ? 'var(--success)' : 'var(--error)';

      ensureReview();
      const idx = state.gameData.completeIndex||0;
      // Guardamos el enunciado mostrado
      const enunciado = document.querySelector('#game-content p.text-2xl')?.innerText || '';
      state.gameData.review.push({ q: enunciado.replace(/\s+/g,' ').trim(), correct, selected, ok });

      if(ok){ confettiEffect(); setTimeout(()=>{ state.gameData.completeIndex=idx+1; renderCompleteTextMC(document.getElementById('game-content')); },800); }
      else{ flashRedEffect(); setTimeout(()=>{ let prev=idx-1; state.gameData.completeIndex=prev<0?0:prev; renderCompleteTextMC(document.getElementById('game-content')); },900); }
    }

    function renderFillInTheBlank(container){
      const promo=promotionsData[state.activePromotionKey]||{};
      const items=(promo.fillInTheBlanks||[]).slice();
      const { fibIndex=0 } = state.gameData;
      if(!items.length){ showSummary(container); return; }
      if(fibIndex>=items.length){ showSummary(container); return; }
      const cur=items[fibIndex];
      container.innerHTML = `
        <p class="text-xl text-gray-300 mb-4">Completa el espacio en blanco</p>
        <p class="text-2xl text-center mb-6">${cur.text.replace('__','<input id="fib-input" class="mx-2 p-2 rounded bg-gray-900 border-2 border-gray-600 focus:border-yellow-400 focus:outline-none text-center w-32" placeholder="...">')}</p>
        <div class="flex justify-center gap-4"><button onclick="checkFIB()" class="btn btn-gold py-2 px-6">Comprobar</button></div>
        <div id="fib-feedback" class="text-center text-sm text-gray-400 h-6"></div>`;
      state.gameData.fibAnswer=String(cur.answer);
      state.gameData.fibIndex=fibIndex;
    }
    function checkFIB(){
      const input=document.getElementById('fib-input'); const fb=document.getElementById('fib-feedback');
      const ok = normalizeText(input.value)===normalizeText(String(state.gameData.fibAnswer||'')); fb.textContent= ok?'¬°Correcto!':'Intenta de nuevo'; fb.style.color= ok?'var(--success)':'var(--error)';
      ensureReview();
      const enunciado = document.querySelector('#game-content p.text-2xl')?.innerText || '';
      state.gameData.review.push({ q: enunciado.replace(/\s+/g,' ').trim(), correct: state.gameData.fibAnswer, selected: input.value, ok });
      if(ok){ confettiEffect(); setTimeout(()=>{ state.gameData.fibIndex=(state.gameData.fibIndex||0)+1; renderFillInTheBlank(document.getElementById('game-content')); },800); }
    }

    function renderTrueFalse(container){
      const promo=promotionsData[state.activePromotionKey]||{};
      const questions=promo.questions||[];
      const { currentTFIndex=0 } = state.gameData;
      if(!questions.length){ showSummary(container); return; }
      if(currentTFIndex>=questions.length){ showSummary(container); return; }
      const q=questions[currentTFIndex];
      const ctx=contextCandidates(state.activePromotionKey, q.question, q.answer)||[];
      const wrong = ctx[0] || q.answer;
      const isTrue = Math.random()>0.5;
      state.gameData.currentTFIsTrue=isTrue;

      container.innerHTML = `
        <p class="text-xl text-gray-300 mb-4">¬øLa siguiente afirmaci√≥n es verdadera o falsa?</p>
        <div class="card p-6 mb-4 text-center text-2xl">${q.question} <br><span class='font-bold text-yellow-400'>${isTrue?q.answer:wrong}</span></div>
        <div class="flex justify-center gap-4">
          <button onclick="checkTrueFalse(true,'${q.question.replace(/'/g,"\\'")}','${q.answer.replace(/'/g,"\\'")}','${(isTrue?q.answer:wrong).replace(/'/g,"\\'")}')" class="btn btn-gold py-3 px-8">Verdadero</button>
          <button onclick="checkTrueFalse(false,'${q.question.replace(/'/g,"\\'")}','${q.answer.replace(/'/g,"\\'")}','${(isTrue?q.answer:wrong).replace(/'/g,"\\'")}')" class="btn bg-gray-600 py-3 px-8">Falso</button>
        </div>
        <div id="tf-feedback" class="text-center text-sm text-gray-400 h-6"></div>`;
    }
    function checkTrueFalse(choice, qText, correct, shown){
      const { currentTFIsTrue, currentTFIndex=0 } = state.gameData;
      const fb=document.getElementById('tf-feedback');
      const ok = choice===currentTFIsTrue;
      if(ok){ fb.textContent='¬°Correcto!'; fb.style.color='var(--success)'; confettiEffect(); }
      else{ fb.textContent='Incorrecto. Retrocedes una pregunta.'; fb.style.color='var(--error)'; flashRedEffect(); }
      ensureReview();
      state.gameData.review.push({ q:`${qText} ‚Üí ${shown}`, correct, selected: choice?'Verdadero':'Falso', ok });
      setTimeout(()=>{
        if(ok){ state.gameData.currentTFIndex=(currentTFIndex||0)+1; }
        else{ let prev=(currentTFIndex||0)-1; state.gameData.currentTFIndex=prev<0?0:prev; }
        renderTrueFalse(document.getElementById('game-content'));
      },850);
    }

    /* =======================
       RESUMEN DE RESPUESTAS
    ======================= */
    function showSummary(container){
      const review = state.gameData.review || [];
      const total = review.length;
      const aciertos = review.filter(r=>r.ok).length;
      container.innerHTML = `
        <div class="card p-6 md:p-8">
          <h3 class="text-2xl font-bold mb-4 text-yellow-400 text-center">Resumen del juego</h3>
          <p class="text-center mb-4">Aciertos: <b>${aciertos}</b> / ${total}</p>
          <div class="space-y-3 max-h-[60vh] overflow-auto pr-2">
            ${review.map((r,i)=>`
              <div class="p-3 rounded ${r.ok?'bg-green-900/30':'bg-red-900/25'}">
                <div class="text-sm text-gray-400 mb-1">#${i+1}</div>
                <div class="font-semibold mb-1">${r.q}</div>
                <div class="text-sm">Tu respuesta: <b>${r.selected || '‚Äî'}</b></div>
                <div class="text-sm">Correcta: <b>${r.correct}</b></div>
              </div>`).join('')}
          </div>
          <div class="text-center mt-6">
            <button class="btn btn-gold py-2 px-6" onclick="finishGame()">Terminar y volver al men√∫</button>
          </div>
        </div>`;
    }
    function finishGame(){ completeLevel(); }

    /* =======================
       UTILS
    ======================= */
    function shuffleArray(a){ const arr=[...a]; for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }
    function normalizeText(t){ return String(t||'').trim().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9%√°√©√≠√≥√∫√º√±√ß\s]/gi,''); }
    function flashRedEffect(){ const o=document.createElement('div'); Object.assign(o.style,{position:'fixed',top:0,left:0,width:'100vw',height:'100vh',background:'rgba(255,0,0,0.25)',zIndex:99999,pointerEvents:'none',transition:'opacity .5s'}); document.body.appendChild(o); setTimeout(()=>o.style.opacity='0',600); setTimeout(()=>o.remove(),900); }
    function confettiEffect(){ /* stub visual */ }

    /* =======================
       NAV FLOW
    ======================= */
    function goToMenu(){ state.currentView='menu'; state.activePromotionKey=null; state.activeGameLevel=0; state.gameData={}; render(); }
    function selectPromotion(key){ if(!promotionsData[key]){ alert('Promoci√≥n sin datos a√∫n.'); return; } state.currentView='game'; state.activePromotionKey=key; state.activeGameLevel=0; state.gameData={review:[]}; render(); }
    function startGame(level){ state.activeGameLevel=level; state.gameData={review:[]}; render(); }
    function completeLevel(){ if(state.progress[state.activePromotionKey] < state.activeGameLevel){ state.progress[state.activePromotionKey]=state.activeGameLevel; } saveProgress(); state.activeGameLevel=0; render(); }

    document.addEventListener('DOMContentLoaded',()=>{ initProgress(); render(); });
  </script>
</body>
</html>
